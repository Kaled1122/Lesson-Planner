<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Lesson Planner ‚Äî Observation Readiness Coach</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --blue: #0071e3;
      --blue-dark: #005bb5;
      --gray-bg: #f5f5f7;
      --gray-light: #e5e5e7;
      --text: #1d1d1f;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--gray-bg);
      color: var(--text);
      margin: 0;
      padding: 40px;
      display: flex;
      justify-content: center;
    }
    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 4px 25px rgba(0,0,0,0.1);
      padding: 40px;
      width: 100%;
      max-width: 720px;
    }
    h1 {
      text-align: center;
      font-size: 28px;
      margin-bottom: 10px;
    }
    h2 {
      text-align: center;
      font-weight: 500;
      color: #555;
      font-size: 16px;
      margin-bottom: 30px;
    }
    label {
      display: block;
      font-weight: 600;
      margin-top: 20px;
      margin-bottom: 5px;
    }
    input, textarea {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 15px;
      box-sizing: border-box;
      resize: vertical;
    }
    textarea {
      min-height: 70px;
    }
    .rating-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 25px 0;
    }
    .rating-btn {
      background: var(--gray-light);
      border: none;
      border-radius: 12px;
      padding: 12px 30px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.25s;
    }
    .rating-btn.active {
      background-color: var(--blue);
      color: white;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    .rating-btn:hover {
      background-color: var(--blue-dark);
      color: white;
    }
    input[type="file"] {
      margin-top: 10px;
    }
    button.generate {
      width: 100%;
      background-color: var(--blue);
      color: white;
      border: none;
      padding: 14px;
      border-radius: 12px;
      font-size: 17px;
      cursor: pointer;
      margin-top: 25px;
      transition: background 0.25s;
    }
    button.generate:hover {
      background-color: var(--blue-dark);
    }
    #output {
      margin-top: 40px;
      background: #fafafa;
      border-radius: 14px;
      padding: 20px;
      white-space: pre-wrap;
      line-height: 1.5;
      font-size: 15px;
      overflow-y: auto;
      max-height: 700px;
      border: 1px solid #ddd;
    }
    .loading {
      text-align: center;
      font-style: italic;
      color: #666;
      padding: 20px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>AI Lesson Planner</h1>
    <h2>Observation Readiness Coach</h2>

    <label>Teacher Name</label>
    <input id="teacherName" type="text" placeholder="e.g. Mr. Saleh Al-Enezi">

    <label>Lesson Number</label>
    <input id="lessonNumber" type="text" placeholder="e.g. Book 7 ‚Äî Lesson 2">

    <label>Lesson Duration</label>
    <input id="lessonDuration" type="text" placeholder="e.g. 45 minutes">

    <label>Learner Profile</label>
    <textarea id="learnerProfile" placeholder="e.g. Intermediate cadets preparing for ALCPT..."></textarea>

    <label>Anticipated Problems</label>
    <textarea id="anticipatedProblems" placeholder="e.g. Difficulty understanding long listening sentences..."></textarea>

    <label>Target Readiness Level</label>
    <div class="rating-buttons">
      <button class="rating-btn" id="goodBtn">Good</button>
      <button class="rating-btn" id="outstandingBtn">Outstanding</button>
    </div>

    <label>Upload Lesson File (PDF, Word, Excel, or Image)</label>
    <input id="fileInput" type="file" accept=".pdf,.docx,.xlsx,.png,.jpg,.jpeg">

    <button class="generate" onclick="generateLessonPlan()">Generate Lesson Plan & Coaching Guide</button>

    <div id="output"></div>
  </div>

  <script>
    const BACKEND_URL = "https://lesson-planner-9gmh.onrender.com/generate"; // üîó your Render backend
    let targetRating = "Good";

    // Toggle Good / Outstanding buttons
    const goodBtn = document.getElementById("goodBtn");
    const outstandingBtn = document.getElementById("outstandingBtn");

    function toggleRating(selected) {
      targetRating = selected;
      [goodBtn, outstandingBtn].forEach(btn => btn.classList.remove("active"));
      if (selected === "Good") goodBtn.classList.add("active");
      else outstandingBtn.classList.add("active");
    }

    goodBtn.onclick = () => toggleRating("Good");
    outstandingBtn.onclick = () => toggleRating("Outstanding");

    async function generateLessonPlan() {
      const outputDiv = document.getElementById("output");
      const fileInput = document.getElementById("fileInput");
      const teacherName = document.getElementById("teacherName").value;
      const lessonNumber = document.getElementById("lessonNumber").value;
      const lessonDuration = document.getElementById("lessonDuration").value;
      const learnerProfile = document.getElementById("learnerProfile").value;
      const anticipatedProblems = document.getElementById("anticipatedProblems").value;

      if (!fileInput.files.length) {
        outputDiv.innerHTML = "<p style='color:red'>Please upload a lesson file.</p>";
        return;
      }

      const formData = new FormData();
      formData.append("file", fileInput.files[0]);
      formData.append("teacher_name", teacherName);
      formData.append("lesson_number", lessonNumber);
      formData.append("lesson_duration", lessonDuration);
      formData.append("learner_profile", learnerProfile);
      formData.append("anticipated_problems", anticipatedProblems);
      formData.append("target_rating", targetRating);

      outputDiv.innerHTML = "<p class='loading'>‚è≥ Generating your tailored lesson plan and coaching guide... Please wait.</p>";

      try {
        const response = await fetch(BACKEND_URL, { method: "POST", body: formData });
        const text = await response.text();
        console.log("RAW RESPONSE:", text);
        let data;
        try { data = JSON.parse(text); } 
        catch { outputDiv.innerHTML = `<p style='color:red'>‚ö†Ô∏è Unexpected server response:</p><pre>${text}</pre>`; return; }

        if (data.lesson_plan) {
          outputDiv.innerHTML = `<h3>‚úÖ Lesson Plan & Coaching Guide</h3><pre>${data.lesson_plan}</pre>`;
        } else {
          outputDiv.innerHTML = `<p style='color:red'>Error: ${data.error || "Unknown error"}</p>`;
        }
      } catch (err) {
        outputDiv.innerHTML = `<p style='color:red'>üö® Server error: ${err.message}</p>`;
      }
    }
  </script>
</body>
</html>
