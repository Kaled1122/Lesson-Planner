<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI Lesson Planner â€” Observation Readiness Coach</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #f5f5f7;
      color: #1d1d1f;
      margin: 0;
      padding: 40px;
      display: flex;
      justify-content: center;
    }
    .container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 4px 25px rgba(0,0,0,0.1);
      padding: 40px;
      width: 100%;
      max-width: 720px;
    }
    h1, h2 {
      text-align: center;
      margin: 0;
    }
    h1 { font-size: 28px; }
    h2 { font-size: 16px; color: #555; margin-bottom: 30px; }
    label { display: block; font-weight: 600; margin-top: 20px; }
    input, textarea {
      width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #ccc; font-size: 15px;
    }
    textarea { min-height: 70px; resize: vertical; }
    .rating-buttons { display: flex; justify-content: center; gap: 20px; margin: 20px 0; }
    .rating-btn {
      background: #e5e5e7; border: none; border-radius: 12px;
      padding: 12px 30px; font-size: 16px; cursor: pointer; transition: all 0.25s;
    }
    .rating-btn.active { background-color: #0071e3; color: white; }
    button.generate {
      width: 100%; background-color: #0071e3; color: white; border: none;
      padding: 14px; border-radius: 12px; font-size: 17px; cursor: pointer; margin-top: 25px;
    }
    button.generate:hover { background-color: #005bb5; }
    #output { margin-top: 30px; text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <h1>AI Lesson Planner</h1>
    <h2>Observation Readiness Coach</h2>

    <label>Teacher Name</label>
    <input id="teacherName" type="text">

    <label>Lesson Number</label>
    <input id="lessonNumber" type="text">

    <label>Lesson Duration</label>
    <input id="lessonDuration" type="text">

    <label>Learner Profile</label>
    <textarea id="learnerProfile"></textarea>

    <label>Anticipated Problems</label>
    <textarea id="anticipatedProblems"></textarea>

    <label>Target Readiness Level</label>
    <div class="rating-buttons">
      <button class="rating-btn" id="goodBtn">Good</button>
      <button class="rating-btn" id="outstandingBtn">Outstanding</button>
    </div>

    <label>Upload Lesson File</label>
    <input id="fileInput" type="file" accept=".pdf,.docx,.xlsx,.png,.jpg,.jpeg">

    <button class="generate" onclick="generateLessonPlan()">Generate and Download Lesson Plan</button>
    <div id="output"></div>
  </div>

  <script>
    const BACKEND_URL = "https://lesson-planner-9gmh.onrender.com/generate";
    let targetRating = "Good";
    const goodBtn = document.getElementById("goodBtn");
    const outstandingBtn = document.getElementById("outstandingBtn");
    goodBtn.onclick = () => toggleRating("Good");
    outstandingBtn.onclick = () => toggleRating("Outstanding");

    function toggleRating(selected) {
      targetRating = selected;
      [goodBtn, outstandingBtn].forEach(b => b.classList.remove("active"));
      (selected === "Good" ? goodBtn : outstandingBtn).classList.add("active");
    }

    async function generateLessonPlan() {
      const outputDiv = document.getElementById("output");
      const fileInput = document.getElementById("fileInput");
      if (!fileInput.files.length) {
        outputDiv.innerHTML = "<p style='color:red'>Please upload a lesson file.</p>";
        return;
      }

      const formData = new FormData();
      formData.append("file", fileInput.files[0]);
      formData.append("teacher_name", document.getElementById("teacherName").value);
      formData.append("lesson_number", document.getElementById("lessonNumber").value);
      formData.append("lesson_duration", document.getElementById("lessonDuration").value);
      formData.append("learner_profile", document.getElementById("learnerProfile").value);
      formData.append("anticipated_problems", document.getElementById("anticipatedProblems").value);
      formData.append("target_rating", targetRating);

      outputDiv.innerHTML = "<p>Generating your lesson plan. Please wait...</p>";

      try {
        const response = await fetch(BACKEND_URL, { method: "POST", body: formData });
        if (!response.ok) throw new Error("Server error");
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "AI_Lesson_Plan.docx";
        document.body.appendChild(a);
        a.click();
        a.remove();
        window.URL.revokeObjectURL(url);
        outputDiv.innerHTML = "<p>Lesson plan downloaded successfully.</p>";
      } catch (err) {
        outputDiv.innerHTML = `<p style='color:red'>Error: ${err.message}</p>`;
      }
    }
  </script>
</body>
</html>
